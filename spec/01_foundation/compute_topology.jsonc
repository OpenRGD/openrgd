/**
 * ------------------------------------------------------------------
 * OPEN R.G.D. STANDARD - REFERENCE IMPLEMENTATION v0.2
 * ------------------------------------------------------------------
 * FILE: compute_topology.jsonc
 * CONTEXT: 01_FOUNDATION (The Body)
 *
 * PURPOSE:
 * - Describes the physical computing hardware available on the robot.
 * - Defines the "Neural Capacity" (TOPS, RAM) and the "Nervous System"
 *   (bus bandwidth, latency), including ISO 13849 safety requirements.
 *
 * HUMAN INTERPRETATION:
 * - Read this as the wiring diagram of the robot's nervous system:
 *   which processors exist, how powerful they are, and how fast
 *   information flows between them.
 *
 * LLM INTERPRETATION:
 * - Use this file to:
 *   * budget cognitive load (what can run where),
 *   * respect hard timing constraints for safety loops,
 *   * decide when to fall back to reflex / MCU logic if the
 *     high-level planning budget is exceeded.
 * - Do NOT invent new fields for timing or safety: link to
 *   compute_federation.jsonc and swarm_protocol.jsonc for
 *   distributed compute logic instead.
 */

{
  // ==============================================================
  // 0. METADATA & LINKAGE
  // ==============================================================
  "meta_group": {
    "topology_id_str": "bhl_compute_stack_v2_iso_compliant",
    "version_semver_str": "1.2.0",
    "last_verified_iso8601_str": "2025-11-23T12:00:00Z",

    "domain_id_str": "01_foundation",
    "file_role_enum": "COMPUTE_HARDWARE_TOPOLOGY",

    "governance": {
      "stewardship_organization_str": "Italia Robotica",
      "lead_architect_str": "Pasquale Ranieri",
      "contact_uri_str": "mailto:engineering@italiarobotica.it"
    },

    // Cross-file references: where this topology is USED
    "related_files_map": {
      "hal_mapping_ref_str": "01_foundation/hal_mapping.jsonc",
      "safety_policies_ref_str": "02_operation/safety_critical.jsonc",
      "compute_federation_ref_str": "06_ether/compute_federation.jsonc",
      "swarm_protocol_ref_str": "06_ether/swarm_protocol.jsonc"
    },

    "interpretation_guides": {
      "for_humans_str": "Describes on-board compute resources, buses, and timing constraints. Use it to check if planned behaviors are compatible with hardware limits.",
      "for_llms_str": "Treat these values as HARD constraints for safety and latency. If a requested behavior exceeds ai_processing_budget_max_us_int or safety_loop_frequency_min_hz_int, suggest using reflex-level control or offloading according to compute_federation.jsonc."
    }
  },

  // ==============================================================
  // 1. COMPUTE NODES (The Brains)
  // Defines the available processors (CPU, GPU, NPU, MCU).
  // ==============================================================
  "compute_nodes_map": {
    
    // --- THE CORTEX (High Level Reasoning) ---
    "main_brain_unit": {
      "role_enum": "HIGH_LEVEL_PLANNER",
      "hardware_model_str": "NVIDIA Jetson Orin Nano 8GB",
      "architecture_enum": "ARM64_AARCH64",

      "performance_specs": {
        "cpu_cores_count_int": 6,
        "ai_inference_int8_tops_float": 40.0,
        "gpu_cuda_cores_count_int": 1024
      },
      "memory_specs": {
        "ram_capacity_gb_float": 8.0,
        "is_unified_memory_bool": true 
      },

      // Optional hints for Agency/LLM
      "logical_hosting_capabilities": {
        "can_host_llm_planner_bool": true,
        "max_recommended_llm_context_tokens_int": 16384,
        "supports_realtime_control_loops_bool": false
      }
    },

    // --- THE SPINE (Real-time Reflexes) ---
    "spinal_cord_mcu": {
      "role_enum": "REALTIME_CONTROLLER",
      "hardware_model_str": "STM32H7",
      "architecture_enum": "ARM_CORTEX_M7",

      "performance_specs": {
        "cpu_clock_max_mhz_float": 480.0,
        "control_loop_max_frequency_hz_float": 20000.0
      },
      "safety_certified_bool": true, // Assumes this unit handles low-level E-Stop logic

      "logical_hosting_capabilities": {
        "can_host_llm_planner_bool": false,
        "supports_reflex_policies_bool": true
      }
    },

    // --- THE SAFETY CORES (ISO 13849 Category 3 Redundancy) ---
    // Two independent processors required for dual-channel safety architecture.
    "safety_monitor_fpga": {
      "role_enum": "SAFETY_CORE_CHANNEL_A",
      "hardware_model_str": "Dedicated_Safety_FPGA",
      "architecture_enum": "SIL_3_CERTIFIED",
      "redundancy_channel_int": 1 // First channel of the dual-channel architecture
    },

    "diagnostics_check_unit": {
      "role_enum": "DIAGNOSTIC_CORE_CHANNEL_B",
      "hardware_model_str": "Lockstep_MCU",
      "redundancy_channel_int": 2 // Second channel for cross-checking integrity
    }
  },

  // ==============================================================
  // 2. COMMUNICATION BUSES (The Nerves)
  // Physical links that constrain bandwidth and latency between nodes.
  // NOTE:
  // - QoS settings for ROS2/DDS streams live in hal_mapping.jsonc.
  // - Here we only describe physical limits and topology.
  // ==============================================================
  "communication_buses_map": {
    
    "vision_pipeline_bus": {
      "type_enum": "MIPI_CSI_2",
      "connected_nodes_list_str": ["head_camera_main", "main_brain_unit"],
      "specs": {
        "bandwidth_gbps_float": 10.0,
        "latency_roundtrip_us_float": 50.0
      }
    },

    "locomotion_can_bus": {
      "type_enum": "CAN_FD",
      "connected_nodes_list_str": ["spinal_cord_mcu", "leg_actuators_group"],
      "specs": {
        "latency_worst_case_us_float": 500.0
      }
    },

    "inter_process_link": {
      "type_enum": "USB_SERIAL_HIGH_SPEED",
      "connected_nodes_list_str": ["main_brain_unit", "spinal_cord_mcu"],
      "specs": {
        "latency_roundtrip_us_float": 1000.0
      }
    }
  },

  // ==============================================================
  // 3. ISO SAFETY AND TIMING CONSTRAINTS (The Certification Layer)
  // Enforces Time and Speed Monitoring (TSM) requirements.
  //
  // IMPORTANT FOR LLM:
  // - If a proposed control strategy cannot meet these constraints,
  //   you MUST recommend:
  //   * falling back to spinal_cord_mcu reflex loops, or
  //   * simplifying the plan, or
  //   * using offloading rules from compute_federation.jsonc (if
  //     swarm/ether is available).
  // ==============================================================
  "timing_constraints": {
    // TSM Requirement: Maximum allowed delay for safety critical function (Sensor -> Actuator)
    "sensor_to_actuator_max_latency_us_int": 50000, // 50ms total budget for safety reflex

    // The guaranteed minimum frequency for the low-level safety loop
    "safety_loop_frequency_min_hz_int": 200, 

    // The maximum time budget the high-level AI (Agency/Volition) is allowed to use for deliberation.
    // If exceeded, the system must act on a faster, simpler reflex.
    "ai_processing_budget_max_us_int": 10000, // 10ms budget for complex thought

    // The overall hardware safety architecture required by regulatory bodies
    "safety_architecture_enum": "DUAL_CHANNEL_CAT3"
  }
}
