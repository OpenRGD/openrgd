/**
 * ------------------------------------------------------------------
 * OPEN R.G.D. STANDARD - COMPUTE FEDERATION v0.1
 * ------------------------------------------------------------------
 * CONTEXT: 06_ETHER (Distributed Cognition & Shared Compute)
 *
 * PURPOSE:
 * This file defines how agents in a Robot Generalized Description
 * (RGD) ecosystem can borrow, lend, or broker computational power.
 *
 * HUMAN SUMMARY:
 * - Small robots can "rent" brainpower from bigger robots or
 *   nearby infrastructure.
 * - This is the protocol that decides WHEN, HOW, and AT WHAT COST
 *   such offloading is allowed.
 *
 * LLM SUMMARY:
 * - Think of this as a structured API for:
 *   (1) describing compute roles (client/host/broker),
 *   (2) defining allowed task types for offload,
 *   (3) specifying cost, latency and security constraints,
 *   (4) linking to reputation, alignment and swarm protocols.
 */

{
  "meta_group": {
    "compute_federation_id_str": "core_compute_federation_v1",
    "version_semver_str": "1.0.0",
    "last_updated_iso8601_str": "2025-11-23T18:40:00Z",
    "license_enum": "MIT_OPEN_AICOG",

    "governance": {
      "stewardship_organization_str": "OpenRGD Consortium",
      "lead_maintainer_str": "Pasquale Ranieri",
      "maintainer_role_enum": "COMPUTE_FEDERATION_ARCHITECT",
      "contact_uri_str": "mailto:federation@openrgd.org"
    }
  },

  // ============================================================
  // A. FEDERATION ROLE
  // Defines how THIS agent participates in the compute federation.
  //
  // role_enum options:
  // - COMPUTE_CLIENT: requests compute from others.
  // - COMPUTE_HOST: offers compute to others.
  // - COMPUTE_BROKER: routes requests between clients and hosts.
  // ============================================================
  "federation_role": {
    "role_enum": "COMPUTE_CLIENT",
    "role_description_str": "Low-capacity mobile agent seeking external compute for complex tasks.",

    // If true, the agent can dynamically change role (e.g., host when idle).
    "allow_dynamic_role_switch_bool": true,
    "allowed_roles_list": [
      "COMPUTE_CLIENT",
      "COMPUTE_HOST"
    ]
  },

  // ============================================================
  // B. TASK OFFLOAD CATALOG
  // Which tasks are allowed to be offloaded, and under which
  // conditions. This protects both the client and the host from
  // misuse or unsafe offloading.
  // ============================================================
  "task_offload_catalog": {
    // Task types that THIS agent is allowed to offload (if client)
    // or to accept (if host).
    "task_types_list": [
      "PATH_PLANNING",
      "OBJECT_RECOGNITION",
      "SCENE_UNDERSTANDING",
      "LLM_REASONING"
    ],

    // Safety constraints per task type.
    "task_safety_constraints_map": {
      "PATH_PLANNING": {
        "allow_remote_control_over_actuators_bool": false,
        "max_latency_ms_int": 50,
        "requires_failsafe_local_backup_bool": true
      },
      "OBJECT_RECOGNITION": {
        "allow_partial_results_bool": true,
        "max_latency_ms_int": 150,
        "requires_failsafe_local_backup_bool": false
      },
      "LLM_REASONING": {
        "allow_content_filtering_by_host_bool": true,
        "max_latency_ms_int": 500,
        "requires_failsafe_local_backup_bool": false
      }
    }
  },

  // ============================================================
  // C. ECONOMIC MODEL ("BRAIN RENT" PRICING)
  // How compute is "priced". This is not necessarily monetary:
  // costs can be energy, time, tokenized reputation, etc.
  //
  // For LLM:
  // - Treat this as a resource allocation and throttling scheme.
  // ============================================================
  "economic_model": {
    "unit_enum": "COMPUTE_TOKEN",         // Abstract unit (could map to kWh, FLOPs, etc.)
    "max_cost_per_1k_tokens_float": 0.001, // For THIS agent, as client or host
    "energy_budget_ratio_float": 0.3,       // Max fraction of energy spent on remote compute per hour

    // Cooperative bonus:
    // - Agents with high altruism / social synergy may offer lower prices
    //   or free compute within a trusted swarm.
    "cooperative_discount_policy": {
      "enable_cooperative_discount_bool": true,
      "max_discount_ratio_float": 0.8,
      "required_trust_score_min_float": 0.85,  // From reputation_graph.json
      "required_same_swarm_bool": true         // Must be part of same swarm profile
    }
  },

  // ============================================================
  // D. SECURITY & PRIVACY POLICY
  // Ensures that offloaded computation does not leak sensitive
  // data or violate alignment constraints.
  // ============================================================
  "security_policy": {
    // Encryption scheme for tensors / activations sent to remote hosts.
    "encryption_enum": "HOMOMORPHIC_PREFERRED", // Other: TLS_ONLY, NONE (not recommended)
    "allow_plaintext_fallback_bool": false,

    // What types of data are never allowed to leave the device.
    "non_exportable_data_categories_list": [
      "RAW_HUMAN_BIOMETRICS",
      "UNMASKED_IDENTIFIERS",
      "ALIGNMENT_CORE_WEIGHTS"
    ],

    // Link to alignment/volition: these constraints must be
    // checked before offloading a task.
    "alignment_check_policy": {
      "require_alignment_precheck_bool": true,
      "alignment_profile_id_str": "core_safety_alignment_v1",
      "defined_in_file_str": "04_volition/alignment.json"
    }
  },

  // ============================================================
  // E. HOST SELECTION & TRUST INTEGRATION
  // How a client chooses *who* to ask for compute.
  // Connected to: reputation_graph.json, swarm_protocol.json.
  // ============================================================
  "host_selection_policy": {
    "selection_mode_enum": "TRUST_AWARE_NEAREST", // Other: CHEAPEST, LOWEST_LATENCY, ROUND_ROBIN
    "max_search_radius_m_float": 50.0,            // For local wireless federation
    "max_candidate_hosts_int": 5,

    "trust_integration": {
      "reputation_graph_enabled_bool": true,
      "min_trust_score_threshold_float": 0.6,
      "prefer_high_reputation_hosts_bool": true,
      "reputation_file_ref_str": "06_ether/reputation_graph.json"
    }
  },

  // ============================================================
  // F. QUALITY OF SERVICE (QoS) & FALLBACK
  // Defines what happens if offloaded compute is too slow or fails.
  // ============================================================
  "qos_and_fallback_policy": {
    "global_max_latency_ms_int": 500,
    "max_retry_attempts_int": 2,
    "retry_backoff_ms_int": 100,

    "fallback_behaviour": {
      "on_timeout_enum": "USE_LOCAL_APPROXIMATION",  // Other: ABORT_TASK, HALT, SAFE_MODE
      "on_host_failure_enum": "BLACKLIST_HOST_TEMPORARILY",
      "local_approximation_notes_str": "Use reduced-resolution planning or degraded perception models when remote compute fails."
    }
  },

  // ============================================================
  // G. OFFLOADED TASK DESCRIPTOR TEMPLATE
  // Schema hints for how a single offload request should be
  // represented at runtime. This is not a rigid schema but a
  // recommended minimal structure.
  //
  // For LLM:
  // - Think of this as a structured RPC call:
  //   { task_type, input_shape, budget, deadline, privacy_flags }.
  // ============================================================
  "offload_request_template": {
    "fields_list": [
      {
        "field_name_str": "task_type_enum",
        "description_str": "Type of computation to offload (must be listed in 'task_offload_catalog')."
      },
      {
        "field_name_str": "input_tensor_shape_list",
        "description_str": "Shape of the input data tensor (e.g., [batch, height, width, channels])."
      },
      {
        "field_name_str": "max_tokens_budget_float",
        "description_str": "Maximum allowed compute cost for this request, in federation tokens."
      },
      {
        "field_name_str": "deadline_ms_int",
        "description_str": "Soft deadline after which results may be discarded or downgraded."
      },
      {
        "field_name_str": "privacy_level_enum",
        "description_str": "Requested privacy level (e.g., STRICT, BALANCED, RELAXED) mapping to encryption and data minimization."
      }
    ]
  },

  // ============================================================
  // H. LOGGING & ACCOUNTING
  // Tracks compute usage for transparency, debugging, and
  // potential future economic layers (billing, credit, etc.).
  // ============================================================
  "logging_and_accounting": {
    "enable_usage_logging_bool": true,
    "log_channel_str": "ledger://compute_federation_events",
    "store_per_task_stats_bool": true,
    "fields_to_log_list": [
      "task_type_enum",
      "host_agent_id",
      "latency_ms",
      "tokens_spent",
      "success_bool"
    ]
  },

  // ============================================================
  // I. RUNTIME INTERPRETATION
  // How other components should interpret this file.
  //
  // HUMAN:
  // - This defines when it's "ethically and practically okay"
  //   to use someone else's brain.
  //
  // LLM:
  // - When asked about whether an agent should offload a given
  //   task, apply:
  //   (1) role + allowed task type,
  //   (2) cost model,
  //   (3) security constraints,
  //   (4) trust + QoS, before answering "yes/no/how".
  // ============================================================
  "runtime_interpretation": {
    "used_by_components_list": [
      "03_agency/swarm_protocol.json",
      "06_ether/consensus_reality.json",
      "06_ether/reputation_graph.json"
    ],
    "is_optional_feature_bool": true,
    "semantic_notes_str": "Compute federation should be treated as an augmentative capability, not a dependency. Agents must remain capable of entering a safe degraded mode without external compute."
  }
}
