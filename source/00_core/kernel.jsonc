/**
 * ------------------------------------------------------------------
 * OPEN R.G.D. STANDARD — KERNEL v0.2
 * ------------------------------------------------------------------
 * FILE: kernel.jsonc
 * CONTEXT: 00_CORE (System Kernel)
 *
 * PURPOSE:
 *   Acts as the high-level runtime coordinator for an OpenRGD bundle.
 *   It:
 *     - Understands the physical body (01_FOUNDATION),
 *     - Orchestrates cognition and values (AGENCY / VOLITION / ETHER),
 *     - Enforces safety, resource limits, and wear budgets,
 *     - Defines how "intent" becomes safe executable commands.
 *
 * HUMAN INTERPRETATION:
 *   Think of this file as the OS kernel + safety supervisor + maintenance
 *   planner for an RGD-compliant robot.
 *
 * LLM INTERPRETATION:
 *   - Do NOT invent new top-level sections.
 *   - Treat all *_ref_str fields as opaque references to other JSONC files.
 *   - Use this file as the canonical map of how different RGD domains
 *     (foundation, agency, volition, ether) interact at runtime.
 */

{
  // ============================================================
  // 0. METADATA & GOVERNANCE (SIGNATURE)
  // ============================================================
  "meta_group": {
    "kernel_profile_id_str": "openrgd_kernel_v0_1_foundation_aware",
    "version_semver_str": "0.1.0",
    "last_updated_iso8601_str": "2025-11-23T22:20:00Z",
    "license_enum": "MIT_OPEN_AICOG",

    "governance": {
      "stewardship_organization_str": "OpenRGD Foundation",
      "lead_maintainer_str": "Pasquale Ranieri",
      "maintainer_role_enum": "KERNEL_ARCHITECT",
      "contact_uri_str": "mailto:kernel@openrgd.org"
    },

    // Link to the schema and expected RGD version
    "rgd_schema_ref_str": "rgd_schema.json",
    "rgd_version_semver_str": "0.2.0"
  },

  // ============================================================
  // 1. FOUNDATION INTROSPECTION
  // The kernel must know which "Body" files exist and what they are for.
  // ============================================================
  "foundation_introspection": {
    "description_file_ref_str": "01_foundation/description.jsonc",
    "calibration_file_ref_str": "01_foundation/calibration.jsonc",
    "compute_topology_file_ref_str": "01_foundation/compute_topology.jsonc",
    "power_distribution_file_ref_str": "01_foundation/power_distribution.jsonc",
    "actuation_library_file_ref_str": "01_foundation/actuation_library.jsonc",
    "actuation_topology_file_ref_str": "01_foundation/actuation_topology.jsonc",
    "actuation_dynamics_file_ref_str": "01_foundation/actuation_dynamics.jsonc",
    "firmware_mapping_file_ref_str": "01_foundation/firmware_mapping.jsonc",
    "hal_mapping_file_ref_str": "01_foundation/hal_mapping.jsonc",
    "physics_solver_overrides_file_ref_str": "01_foundation/physics_solver_overrides.jsonc",
    "soft_materials_library_file_ref_str": "01_foundation/soft_materials_library.jsonc",
    "soft_body_dynamics_file_ref_str": "01_foundation/soft_body_dynamics.jsonc",
    "surface_properties_file_ref_str": "01_foundation/surface_properties.jsonc",
    "sensor_fidelity_file_ref_str": "01_foundation/sensor_fidelity.jsonc",
    "sensor_health_monitor_file_ref_str": "01_foundation/sensor_health_monitor.jsonc",
    "wear_fatigue_model_file_ref_str": "01_foundation/wear_fatigue_model.jsonc"
  },

  // ============================================================
  // 2. MODULE LOAD ORDER
  // Load physical reality first, then cognition, then civilization.
  // ============================================================
  "module_loading_order_list": [
    // --- 01_FOUNDATION (Body) ---
    "01_foundation/description.jsonc",
    "01_foundation/calibration.jsonc",
    "01_foundation/compute_topology.jsonc",
    "01_foundation/power_distribution.jsonc",
    "01_foundation/actuation_library.jsonc",
    "01_foundation/actuation_topology.jsonc",
    "01_foundation/actuation_dynamics.jsonc",
    "01_foundation/firmware_mapping.jsonc",
    "01_foundation/hal_mapping.jsonc",
    "01_foundation/physics_solver_overrides.jsonc",
    "01_foundation/soft_materials_library.jsonc",
    "01_foundation/soft_body_dynamics.jsonc",
    "01_foundation/surface_properties.jsonc",
    "01_foundation/sensor_fidelity.jsonc",
    "01_foundation/sensor_health_monitor.jsonc",
    "01_foundation/wear_fatigue_model.jsonc",

    // --- 03_AGENCY (Model & Skills) ---
    "03_agency/world_model.jsonc",
    "03_agency/skills_library.jsonc",
    "03_agency/empathy_model.jsonc",

    // --- 04_VOLITION (Values & Intent) ---
    "04_volition/alignment.jsonc",
    "04_volition/orchestra.jsonc",
    "04_volition/social_synergy.jsonc",
    "04_volition/ledger.jsonc",
    "04_volition/immunology.jsonc",
    "04_volition/narrative_engine.jsonc",

    // --- 06_ETHER (Collective Layer) ---
    "06_ether/consensus_reality.jsonc",
    "06_ether/compute_federation.jsonc",
    "06_ether/ephemeral_skills.jsonc",
    "06_ether/reputation_graph.jsonc",
    "06_ether/civilization_manifesto.jsonc"
  ],

  // ============================================================
  // 3. HARDWARE RUNTIME PROFILE ENGINE
  // Connects compute, power, firmware and HAL/QoS into one runtime view.
  // ============================================================
  "hardware_runtime_profile_engine": {
    "compute_topology_ref_str": "01_foundation/compute_topology.jsonc",
    "power_distribution_ref_str": "01_foundation/power_distribution.jsonc",
    "hal_mapping_ref_str": "01_foundation/hal_mapping.jsonc",
    "firmware_mapping_ref_str": "01_foundation/firmware_mapping.jsonc",

    "enforce_timing_constraints_bool": true,
    "enforce_power_budget_bool": true,

    "timing_guardrails": {
      // Maximum end-to-end latency (sensor → safety chain → actuator)
      "max_sensor_to_actuator_latency_us_int": 50000,
      // Time budget for high-level AI deliberation before falling back to reflex
      "ai_deliberation_budget_us_int": 10000
    },

    "power_guardrails": {
      "low_battery_soc_safe_mode_threshold_float": 0.15,
      "hard_shutdown_soc_threshold_float": 0.05
    }
  },

  // ============================================================
  // 4. SIMULATION / PHYSICS PROFILE ENGINE
  // Aligns solver-specific parameters across MuJoCo / PhysX / Isaac.
  // ============================================================
  "simulation_profile_engine": {
    "physics_solver_overrides_ref_str": "01_foundation/physics_solver_overrides.jsonc",
    "soft_materials_library_ref_str": "01_foundation/soft_materials_library.jsonc",
    "soft_body_dynamics_ref_str": "01_foundation/soft_body_dynamics.jsonc",
    "surface_properties_ref_str": "01_foundation/surface_properties.jsonc",

    "supported_backends_list_enum": [
      "PHYSX_ISAAC_4_X",
      "PHYSX_ISAAC_5_X",
      "MUJOCO_3_X"
    ],

    "backend_selection_policy_enum": "MATCH_HARDWARE_AND_TASK"
  },

  // ============================================================
  // 5. PERCEPTION & SENSOR HEALTH ENGINE
  // Bridges ideal sensing, realistic noise, and fault detection.
  // ============================================================
  "perception_health_engine": {
    "sensor_fidelity_ref_str": "01_foundation/sensor_fidelity.jsonc",
    "sensor_health_monitor_ref_str": "01_foundation/sensor_health_monitor.jsonc",

    "degrade_confidence_when_fault_bool": true,
    "fallback_strategy_enum": "REDUNDANCY_OR_SAFE_HALT"
  },

  // ============================================================
  // 6. ACTUATION ENVELOPE ENGINE
  // Enforces physical joint limits and safe torque/velocity envelopes.
  // ============================================================
  "actuation_envelope_engine": {
    "actuation_library_ref_str": "01_foundation/actuation_library.jsonc",
    "actuation_topology_ref_str": "01_foundation/actuation_topology.jsonc",
    "actuation_dynamics_ref_str": "01_foundation/actuation_dynamics.jsonc",

    "enforce_joint_limits_bool": true,
    "enforce_torque_speed_envelope_bool": true,
    "soft_limit_margin_rad_float": 0.05
  },

  // ============================================================
  // 7. WEAR BUDGET ENGINE
  // Connects runtime counters (cycles, torque, temperature, hours)
  // to fatigue models and exposes remaining life fractions.
  // ============================================================
  "wear_budget_engine": {
    "wear_fatigue_model_ref_str": "01_foundation/wear_fatigue_model.jsonc",
    "update_interval_s_float": 1.0,

    "runtime_counters_map": {
      "actuator_revolutions": {
        "source_enum": "FIRMWARE_TELEMETRY",
        "preferred_counter_key_str": "joint_revolution_count"
      },
      "joint_torque_integral": {
        "source_enum": "LOW_LEVEL_CONTROLLER",
        "preferred_counter_key_str": "torque_nm_integral",
        "aggregation_window_s_float": 10.0
      },
      "component_temperature_peaks": {
        "source_enum": "THERMAL_SENSORS",
        "preferred_counter_key_str": "max_temp_c_last_window",
        "aggregation_window_s_float": 60.0
      },
      "operational_hours": {
        "source_enum": "SYSTEM_UPTIME",
        "preferred_counter_key_str": "uptime_hours_total"
      }
    },

    "export_remaining_life_to": [
      "04_volition/ledger.jsonc",
      "04_volition/immunology.jsonc",
      "actuation_envelope_engine",
      "hardware_runtime_profile_engine"
    ]
  },

  // ============================================================
  // 8. VOLITION / ORCHESTRA ENGINE
  // Combines values, priorities and social goals into an "intent vector".
  // ============================================================
  "volition_orchestra_engine": {
    "alignment_ref_str": "04_volition/alignment.jsonc",
    "orchestra_ref_str": "04_volition/orchestra.jsonc",
    "social_synergy_ref_str": "04_volition/social_synergy.jsonc",
    "ledger_ref_str": "04_volition/ledger.jsonc",

    "consider_wear_as_soft_cost_bool": true,
    "consider_power_as_soft_cost_bool": true,
    "consider_risk_as_hard_constraint_bool": true
  },

  // ============================================================
  // 9. SAFETY SUPERVISOR (MULTI-DOMAIN)
  // Final arbiter before any physical command is executed.
  // ============================================================
  "safety_supervisor": {
    "alignment_invariants_ref_str": "04_volition/alignment.jsonc",
    "surface_properties_ref_str": "01_foundation/surface_properties.jsonc",
    "sensor_health_monitor_ref_str": "01_foundation/sensor_health_monitor.jsonc",
    "power_distribution_ref_str": "01_foundation/power_distribution.jsonc",
    "wear_fatigue_model_ref_str": "01_foundation/wear_fatigue_model.jsonc",

    "max_impact_energy_j_float": 50.0,
    "block_on_sensor_blindness_bool": true,
    "block_on_critical_power_fault_bool": true,
    "block_on_critical_wear_fraction_float": 0.95
  },

  // ============================================================
  // 10. EXECUTION PIPELINE
  // Intent → checks → commands to the low-level controller.
  // ============================================================
  "execution_pipeline": {
    "command_source_enum": "VOLITION_ORCHESTRA",
    "pre_checks_list": [
      "safety_supervisor",
      "hardware_runtime_profile_engine",
      "perception_health_engine",
      "actuation_envelope_engine"
    ],
    "output_target_str": "runtime://low_level_controller",
    "latency_budget_ms_int": 25,
    "interruptible_bool": true
  },
  // ============================================================
  // 11. FAILSAFE & RECOVERY
  // If the Kernel fails or becomes uncertain.
  // ============================================================
  "failsafe_mechanisms": {
    "uncertainty_threshold_float": 0.65,
    "fallback_mode_enum": "REFLEX_ONLY",
    "log_file_str": "ledger://kernel_failsafe_events"
  }
}
